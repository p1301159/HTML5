<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
       <canvas id=dessin width=440 height=280></canvas>
    </body>
</html>

<script>      
	  
	var monCanvas=document.getElementById('dessin');

	if(monCanvas.getContext){
		var ctx=monCanvas.getContext('2d');
		ctx.fillStyle="blue";
		Cercles=[[monCanvas.width/2,monCanvas.height-20,10]];
		var myBalls = new Array();
                //myBalls.push([monCanvas.width/2,monCanvas.height-20,10]);
		
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2]);
		
		var interval=setInterval(bouleTombe,1);
                
		ctx.save();
	}
	else{
		alert('on vous a dit de ne pas utiliser IE!!!!!!!!!!!');
	}
	
	//monCanvas.addEventListener('mousedown',sourisdown,false);
	//monCanvas.addEventListener('mouseup',sourisup,false);
	monCanvas.addEventListener('click',click,false);
	
	var xSourisDoc;	
	var ySourisDoc;
        var total_x=0;
        var total_y=0;
        var delta_x=0;
        var delta_y=0;
        var vitesse = 1;
	
        
	function click(e){
            xSourisDoc=e.pageX;
            ySourisDoc=e.pageY;
            console.log('clic en',xSourisDoc,ySourisDoc);
            var xCanvas=monCanvas.offsetLeft;
            var yCanvas=monCanvas.offsetTop;
            var xSourisCan=xSourisDoc-xCanvas;
            var ySourisCan=ySourisDoc-yCanvas;

            console.log(Cercles[0][0]-xSourisDoc);
            console.log(Cercles[0][1]-ySourisDoc);
            console.log("ok");
            boulemove(xSourisDoc,ySourisDoc);
	}
	
	function cercle(x,y,r){
		ctx.beginPath();
		ctx.arc(x,y,r,0,2*Math.PI,false);
		ctx.closePath();
		ctx.stroke();
		ctx.fill();
	}
	
	function bouleTombe(){
            
                ctx.save();
		
		ctx.clearRect(0,0,monCanvas.width,monCanvas.height);
            
                
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2]); 
                
                
                /*Cercles[0][0]=Cercles[0][0]+total_x;
                Cercles[0][1]=Cercles[0][1]+total_y;
                */
               
                /*
                 if(((Cercles[0][0]+Cercles[0][2])>=monCanvas.width) || (Cercles[0][0]<=Cercles[0][2])){
                    vitesseX *= -1;
                }
                if(Cercles[0][1]<=Cercles[0][2]){
                    vitesseY *= -1;
                }
                Cercles[0][0]+=vitesseX;
                Cercles[0][1]+=vitesseY;
                 */
                
                if(((Cercles[0][0]+Cercles[0][2])>=monCanvas.width) || (Cercles[0][0]<=Cercles[0][2])){
                    total_x *= -1;
                }
                if(Cercles[0][1]<=Cercles[0][2]){
                    total_y *= 0;
                    total_x *= 0;
                }
                
                Cercles[0][0]+=total_x*vitesse;
                Cercles[0][1]+=total_y*vitesse;
                
                ctx.restore();
	}
        
        function boulemove(x,y){
                delta_x=(x-Cercles[0][0]);
                delta_y=(y-Cercles[0][1]);
                total_x=delta_x/Math.sqrt(delta_x*delta_x+delta_y*delta_y);
                total_y=delta_y/Math.sqrt(delta_x*delta_x+delta_y*delta_y);
        }
        
  </script>