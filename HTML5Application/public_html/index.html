<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
       <canvas id=dessin width=440 height=280></canvas>
    </body>
</html>

<script>      
	  
	var monCanvas=document.getElementById('dessin');

	if(monCanvas.getContext){
		var ctx=monCanvas.getContext('2d');
                var rayon=10;
		Cercles=[[monCanvas.width/2,monCanvas.height-20,10,"blue"]];
                
		var myBalls = new Array();
		var myColors = new Array("blue","red","black","yellow");
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]);
		
		var interval=setInterval(bouleTombe,1);
                
		ctx.save();
	}
	else{
		alert('on vous a dit de ne pas utiliser IE!!!!!!!!!!!');
	}
	monCanvas.addEventListener('click',click,false);
	
	var xSourisDoc;	
	var ySourisDoc;
        var total_x=0;
        var total_y=0;
        var delta_x=0;
        var delta_y=0;
        var vitesse = 3;
	
        
	function click(e){
            xSourisDoc=e.pageX;
            ySourisDoc=e.pageY;
          //  console.log('clic en',xSourisDoc,ySourisDoc);
            var xCanvas=monCanvas.offsetLeft;
            var yCanvas=monCanvas.offsetTop;
            var xSourisCan=xSourisDoc-xCanvas;
            var ySourisCan=ySourisDoc-yCanvas;
            boulemove(xSourisDoc,ySourisDoc);
	}
	
	function cercle(x,y,r,coul){
            
		ctx.fillStyle=coul;
		ctx.beginPath();
		ctx.arc(x,y,r,0,2*Math.PI,false);
		ctx.closePath();
		ctx.stroke();
		ctx.fill();
	}
	
	function bouleTombe(){
            
                ctx.save();
		
		ctx.clearRect(0,0,monCanvas.width,monCanvas.height);
            
                for(var i=0;i<myBalls.length;i++){
                    cercle(myBalls[i][0],myBalls[i][1],myBalls[i][2],myBalls[i][3]);
                     if(myBalls[i][1] >= monCanvas.height-70){
                        myBalls.splice(0,myBalls.length);
                        alert("You Lose!!!! Try again");
                    }
                }
                
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]); 
                if(((Cercles[0][0]+Cercles[0][2])>=monCanvas.width) || (Cercles[0][0]<=Cercles[0][2])){
                    total_x *= -1;
                }
                for (var i = 0; i < myBalls.length; i++) {
                    distance = Math.sqrt(((Cercles[0][0] - myBalls[i][0]) * (Cercles[0][0] - myBalls[i][0])) + ((Cercles[0][1] - myBalls[i][1]) * (Cercles[0][1] - myBalls[i][1])));
                    if ((distance - (Cercles[0][2]*2)) <= 2) {
                        total_y *= 0;
                        total_x *= 0;
                        myBalls.push([Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]]);
                        Cercles.push([monCanvas.width / 2, monCanvas.height - 20, 10,myColors[Math.floor(Math.random()*4)]]);
                        Cercles.shift();//Permet d'enlever le 1er element
                        cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]);
                    }
                }
                if (Cercles[0][1] <= Cercles[0][2]) {
                    total_y *= 0;
                    total_x *= 0;
                    myBalls.push([Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]]);
                    console.log(myBalls.length);
                    Cercles.push([monCanvas.width / 2, monCanvas.height - 20, 10,myColors[Math.floor(Math.random()*4)]]);
                    Cercles.shift();//Permet d'enlever le 1er element
                    cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2],Cercles[0][3]);
                }
                Cercles[0][0] += total_x * vitesse;
                Cercles[0][1] += total_y * vitesse;
                ctx.restore();
            }
        
        function boulemove(x,y){
                delta_x=(x-Cercles[0][0]);
                delta_y=(y-Cercles[0][1]);
                total_x=delta_x/Math.sqrt(delta_x*delta_x+delta_y*delta_y);
                total_y=delta_y/Math.sqrt(delta_x*delta_x+delta_y*delta_y);
        }
        
  </script>