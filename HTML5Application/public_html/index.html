<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <canvas id=dessin width=400 height=400></canvas>
    </body>
</html>

<script>

    var monCanvas = document.getElementById('dessin');


    //monCanvas.width=document.body.clientWidth;
    //monCanvas.height=document.body.clientHeight;

    if (monCanvas.getContext) {

        var ctx = monCanvas.getContext('2d');

        //main();
    }
    else {
        alert('on vous a dit de ne pas utiliser IE!!!!!!!!!!!');
    }

    //La 1er balle
    Cercles = [[monCanvas.width / 2, monCanvas.height - 20, "blue"]];
    //Le tableau contenant les balles qui sont collées
    var myBalls = new Array();
    //Les différentes couleurs des balles
    var myColors = new Array("blue", "red", "black", "yellow");

    //Vecteur unitaire permettant de faire bouger la balle d'une seul unité
    var total_x = 0;
    var total_y = 0;
    //Permet de connaitre la direction dont la balle va prendre
    var delta_x = 0;
    var delta_y = 0;
    //Vitesse de la balle
    var vitesse = 15;
    //Permet que le clic du joueur ne soit comptabiliser qu'une seul foix
    var cptClic = 0;
    //Rayon des balles
    var rayonBall = 15;
    //Limite de jusqu'ou les balles peuvent descendre
    var limite = 70;

    cercle(Cercles[0][0], Cercles[0][1], Cercles[0][2]);
    var interval = setInterval(jouer, 1);
    monCanvas.addEventListener('click', click, false);

    //Fonction permettant de récupérer le clic de la souris
    function click(e) {
        xSourisDoc = e.pageX;
        ySourisDoc = e.pageY;
        boulemove(xSourisDoc, ySourisDoc);
    }

    //Fonction permettant de dessiner mon cercle
    function cercle(x, y, coul) {
        ctx.fillStyle = coul;
        ctx.beginPath();
        ctx.arc(x, y, rayonBall, 0, 2 * Math.PI, false);
        ctx.closePath();
        ctx.stroke();
        ctx.fill();
    }

    //Fonction permettant de redéssiner les balles une fois collé et permet de cloturer une partie une fois la limite atteinte
    function balleUp() {
        for (var i = 0; i < myBalls.length; i++) {
            cercle(myBalls[i][0], myBalls[i][1], myBalls[i][2]);
            if ((myBalls[i][1] + rayonBall) >= monCanvas.height - limite) {
                alert("You Lose!!!! Try again Your Score: " + myBalls.length);
                myBalls.splice(0, myBalls.length);

            }
        }
    }

    //Fonction permettant d'arreter la balle un fois qu'elle touche une autre balle
    function detecterBall() {
        for (var i = 0; i < myBalls.length; i++) {
            distance = Math.sqrt(((Cercles[0][0] - myBalls[i][0]) * (Cercles[0][0] - myBalls[i][0])) + ((Cercles[0][1] - myBalls[i][1]) * (Cercles[0][1] - myBalls[i][1])));
            if ((distance - (rayonBall * 2)) <= 2) {
                total_y *= 0;
                total_x *= 0;
                myBalls.push([Cercles[0][0], Cercles[0][1], Cercles[0][2]]);
                Cercles.push([monCanvas.width / 2, monCanvas.height - 20, myColors[Math.floor(Math.random() * myColors.length)]]);
                Cercles.shift();//Permet d'enlever le 1er element
                cercle(Cercles[0][0], Cercles[0][1], Cercles[0][2]);
                cptClic = 0;
            }
        }
    }

    //Fonction permettant de jouer
    function jouer() {
        ctx.save();
        ctx.clearRect(0, 0, monCanvas.width, monCanvas.height);

        balleUp();

        cercle(Cercles[0][0], Cercles[0][1], Cercles[0][2]);

        //Permet de faire rebondire les balles sur les côtes
        if (((Cercles[0][0] + rayonBall) >= monCanvas.width) || (Cercles[0][0] <= rayonBall)) {
            total_x *= -1;
        }

        //Permet d'arreter le balle un fois arriver en haut du canvas
        if (Cercles[0][1] <= rayonBall) {
            total_y *= 0;
            total_x *= 0;
            myBalls.push([Cercles[0][0], Cercles[0][1], Cercles[0][2]]);
            console.log(myBalls.length);
            Cercles.push([monCanvas.width / 2, monCanvas.height - 20, myColors[Math.floor(Math.random() * myColors.length)]]);
            Cercles.shift();//Permet d'enlever le 1er element
            cercle(Cercles[0][0], Cercles[0][1], Cercles[0][2]);
            cptClic = 0;
        }
        
        //Fonction permettant d'arreter la balle un fois qu'elle touche une autre balle
        detecterBall();

        Cercles[0][0] += total_x * vitesse;
        Cercles[0][1] += total_y * vitesse;
        ctx.restore();
        
        //Scrore
        ctx.strokeText(myBalls.length, 10, 20);
    }

    //Fonction permettant de connaitre direction et la vitesse de la balle
    function boulemove(x, y) {
        if (cptClic === 0) {
            delta_x = (x - Cercles[0][0]);
            delta_y = (y - Cercles[0][1]);
            total_x = delta_x / Math.sqrt(delta_x * delta_x + delta_y * delta_y);
            total_y = delta_y / Math.sqrt(delta_x * delta_x + delta_y * delta_y);
            cptClic++;
        }
    }

</script>