<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
       <canvas id=dessin width=440 height=280></canvas>
    </body>
</html>

<script>      
	  
	var monCanvas=document.getElementById('dessin');

	if(monCanvas.getContext){
		var ctx=monCanvas.getContext('2d');
		ctx.fillStyle="blue";
		Cercles=[[monCanvas.width/2,monCanvas.height-15,10],[150,50,50],[250,50,50]];
		
		
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2]);
		cercle(Cercles[1][0],Cercles[1][1],Cercles[1][2]);
		cercle(Cercles[2][0],Cercles[2][1],Cercles[2][2]);
		
		var interval=setInterval(bouleTombe,1);
                
		ctx.save();
	}
	else{
		alert('on vous a dit de ne pas utiliser IE!!!!!!!!!!!');
	}
	
	//monCanvas.addEventListener('mousedown',sourisdown,false);
	//monCanvas.addEventListener('mouseup',sourisup,false);
	monCanvas.addEventListener('click',click,false);
	
	var xSourisDoc;	
	var ySourisDoc;
        var total_x=0;
        var total_y=0;
        var delta_x=0;
        var delta_y=0;
        var vitesseX = 3;
        var vitesseY = 3;
	
        
	function click(e){
            xSourisDoc=e.pageX;
            ySourisDoc=e.pageY;
            console.log('clic en',xSourisDoc,ySourisDoc);
            var xCanvas=monCanvas.offsetLeft;
            var yCanvas=monCanvas.offsetTop;
            var xSourisCan=xSourisDoc-xCanvas;
            var ySourisCan=ySourisDoc-yCanvas;

            console.log(Cercles[0][0]-xSourisDoc);
            console.log(Cercles[0][1]-ySourisDoc);
            console.log("ok");
            boulemove(xSourisDoc,ySourisDoc);
	}
	
	function sourisup(e){
		if((Cercles[0][2]>Math.abs(Cercles[0][0]-e.pageX) )&& (Cercles[0][2]>Math.abs(Cercles[0][1]-e.pageY))){
			ctx.fillStyle="red";
			cercle(150,150,50);	
			console.log("ok");
		}	
	}
	
	function sourisdown(e){	
		if((Cercles[0][2]>Math.abs(Cercles[0][0]-e.pageX) )&& (Cercles[0][2]>Math.abs(Cercles[0][1]-e.pageY))){
			console.log("ok");
			ctx.fillStyle="blue";
			cercle(150,150,50);
		}
	}
	
	function cercle(x,y,r){
		ctx.beginPath();
		ctx.arc(x,y,r,0,2*Math.PI,false);
		ctx.closePath();
		ctx.stroke();
		ctx.fill();
	}
	
	function bouleTombe(){
            
                ctx.save();
		
		ctx.clearRect(0,0,monCanvas.width,monCanvas.height);
            
                
		cercle(Cercles[0][0],Cercles[0][1],Cercles[0][2]); 
                if((Cercles[0][0]+Cercles[0][2])>=monCanvas.width || Cercles[0][0]<=Cercles[0][2])){
                    vitesseX *= -1;
                }else if(Cercles[0][1]<=Cercles[0][2]){
                    vitesseY *= -1;
                }else{
                    Cercles[0][0]=Cercles[0][0]+total_x;
                    Cercles[0][1]=Cercles[0][1]+total_y;
                }
                
                /*if((Cercles[0][0]+Cercles[0][2])>=monCanvas.width || Cercles[0][0]<=Cercles[0][2])){
                    vitesseX *= -1;
                }
                if(Cercles[0][1]<=Cercles[0][2]){
                    vitesseY *= -1;
                }
                Cercles[0][0]+=vitesseX;
                Cercles[0][1]+=vitesseY;*/
                
                ctx.restore();
	}
        
        function boulemove(x,y){
                delta_x=(x-Cercles[0][0]);
                delta_y=(y-Cercles[0][1]);
                total_x=delta_x/Math.sqrt(x*x+y*y);
                total_y=delta_y/Math.sqrt(x*x+y*y);
                
        }
        
  </script>